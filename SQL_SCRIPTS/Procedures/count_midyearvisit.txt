DELIMITER $$

USE `_clinic`$$

DROP PROCEDURE IF EXISTS `count_midyearvisit`$$

CREATE DEFINER=`smuclinic`@`localhost` PROCEDURE `count_midyearvisit`()
BEGIN

	SELECT COUNT(P.id) AS "Number of Mid-Year Visits",D.Department
	FROM patient AS P	
	INNER JOIN department AS D
	ON P.Department_id=D.Department_id
	INNER JOIN treatment AS T
	ON T.uid=P.uid
	WHERE T.TreatmentDate BETWEEN CONCAT(YEAR(NOW()),"-05-01") AND CONCAT(YEAR(NOW()),"-06-31")	 
	GROUP BY D.Department;	
END$$

DELIMITER ;